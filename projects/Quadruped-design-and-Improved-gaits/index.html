<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Reinforcement Learning for Flexible back Quadruped | Shail Dalal Portfolio</title> <meta name="author" content="Shail Dalal"> <meta name="description" content="Learning gaits using RL for a self designed quadruped"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://sdalal1.github.io/projects/Quadruped-design-and-Improved-gaits/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Shail Dalal Portfolio</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Reinforcement Learning for Flexible back Quadruped</h1> <p class="post-description">Learning gaits using RL for a self designed quadruped</p> </header> <article> <h3 id="project-designing-a-quadruped-and-implementing-gaits-using-reinforcement-learning"><strong>Project: Designing a Quadruped and Implementing Gaits Using Reinforcement Learning</strong></h3> <p><br></p> <h4 id="overview"><strong>Overview</strong></h4> <p>This project focused on designing a high-speed quadruped inspired by the biomechanics of agile animals like greyhounds. The primary goal was to develop a simulation of a quadruped capable of efficient locomotion by integrating mechanical innovation with reinforcement learning (RL). The project consisted of three phases:</p> <ol> <li> <strong>Simulation of various robot designs</strong> to optimize locomotion parameters.</li> <li> <strong>Development of walking gaits using RL</strong> in simulated environments.</li> <li> <strong>Construction of a modular quadruped</strong> for real-world deployment and evaluation.</li> </ol> <p>Here is the <strong><a href="https://github.com/sdalal1/Fast-Quadruped-" rel="external nofollow noopener" target="_blank">link</a></strong> to the github repository.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <div class="embed-container"> <iframe width="640" height="390" src="https://www.youtube.com/embed/jSoEVCyRTfc" frameborder="0" allowfullscreen=""></iframe> </div> <style>.embed-container{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;max-height:80%}.embed-container iframe,.embed-container object,.embed-container embed{position:absolute;top:0;left:0;width:100%;height:100%}</style> </div> </div> <hr> <h4 id="simulation-and-design-innovations"><strong>Simulation and Design Innovations</strong></h4> <p>The initial phase involved extensive simulations in MuJoCo to explore various robot configurations and their impact on locomotion efficiency, with iterative design improvements focused on reducing complexity while enhancing performance. Starting with variations of the Half-Cheetah template, the simulations incorporated design changes inspired by greyhounds to optimize the quadruped’s structure and mechanics for greater efficiency.</p> <p>Quick Summary of the changes sections:</p> <ul> <li> <strong>Reducing Degrees of Freedom (DoF)</strong>: <ul> <li>Simplified the standard 12-DoF configuration to 8-DoF by eliminating hip motors.</li> <li>Improved straight-line speed and reduced control complexity while maintaining essential movement.</li> </ul> </li> <li> <strong>Torque Optimization</strong>: <ul> <li>Modeled motor torques to mimic the force distribution seen in greyhounds, emphasizing stronger upper-leg joints.</li> <li>Enhanced energy efficiency and stability during high-speed motion.</li> </ul> </li> <li> <strong>Segmented Back Design</strong>: <ul> <li>Introduced a flexible, spine-like back to improve stride length and energy transfer.</li> <li>Simulations demonstrated a significant increase in speed and smoother gaits compared to rigid designs.</li> </ul> </li> <li><strong>A Picture Collage of all the different styles</strong></li> </ul> <div class="row mt-3"> <div class="col-sm mt-2 mt-md-0"> <style>.center-img{display:block;margin-left:auto;margin-right:auto}</style> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/multiple_designs-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/multiple_designs-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/multiple_designs-1400.webp"></source> <img src="/assets/img/multiple_designs.png" class="center-img" width="auto" height="auto" title="Collage" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><strong>2 Dimensional Design</strong></p> <ul> <li>Using the half-cheetah model—a 2D, 6-DOF system—I aimed to simplify the design to a 4-DOF configuration, laying the groundwork for an eventual 8-DOF quadruped system. This approach sought to demonstrate that a hip joint is not essential for linear motion. The modifications were explored as follows: <ul> <li>Removing the foot link: The first iteration involved eliminating the foot link to create a 4-DOF system constrained to linear motion, preventing sideways movement.</li> <li>Passive Shin Actuation: The second approach removed the shin motor, allowing the shin to move passively under the influence of the foot and thigh motors while maintaining a 4-DOF setup.</li> <li>Passive Foot Actuation: Lastly, the foot motor was removed, enabling passive actuation of the foot, with the thigh and shin motors controlling movement.</li> </ul> </li> <li>Despite these efforts, the 2D models struggled to achieve effective training results. The primary challenge stemmed from the critical role of the original 6-DOF configuration in maintaining balance during motion. Without it, the system required the legs to move at high speeds to prevent the torso from tipping forward or backward, leading to instability.</li> </ul> <div class="row mt-3"> <div class="col-sm mt-2 mt-md-0"> <style>.center-img{display:block;margin-left:auto;margin-right:auto}</style> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2D_design-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2D_design-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2D_design-1400.webp"></source> <img src="/assets/img/2D_design.png" class="center-img" width="auto" height="auto" title="Collage" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <ul> <li>This exploration highlighted the limitations of simplifying the 2D design, prompting a shift towards developing an 8-DOF quadruped system in 2D. The insights gained from these experiments guided the transition to a full 3D design with four legs, which I will elaborate on in the next section.</li> </ul> <p><strong>4 Legged 3D design</strong></p> <ul> <li> <p>Following the challenges encountered in achieving stable gaits without tipping in the simplified 2D designs, I transitioned to modeling a complete 4-legged system. This shift introduced new complexities due to the hierarchical parent-child relationship of links in MuJoCo, necessitating several iterations to ensure the legs were both individually articulated and properly connected to the torso link.</p> </li> <li>Initial Design and Y-Direction Constrained Training: <ul> <li>Once the 4-legged model was successfully constructed, I began training the gaits with a constraint limiting movement to the Y-direction. This approach yielded excellent results, producing smooth forward motion and a natural walking gait for a single-link torso.</li> <li>This stage leveraged motor values from the original MuJoCo half-cheetah model and demonstrated the feasibility of stable motion.</li> </ul> </li> <li>Scaling for Real-World Implementation: <ul> <li>After achieving promising results in simulation, I refined the model to be more realistic for physical implementation.</li> <li>The entire system was scaled down to approximately one-third the size of the original half-cheetah model.</li> <li>Motor torques were adjusted to reflect specifications of off-the-shelf components, aligning the simulated design with practical constraints.</li> </ul> </li> <li>Training in 2D: <ul> <li>Using the scaled-down model, I trained the quadruped in 2D. This phase was highly successful, resulting in stable walking gaits.</li> </ul> </li> <li>Unconstrained Gait Training: <ul> <li>Building on the success of 2D training, I removed the Y-direction constraint to enable movement in all directions.</li> <li>This transition opened up new opportunities for refining the model, focusing on achieving balance and developing more versatile and efficient gaits, which will be elaborated on in the reinforcement learning section.</li> </ul> </li> </ul> <div class="row mt-3"> <div class="col-sm mt-2 mt-md-0"> <style>.center-img{display:block;margin-left:auto;margin-right:auto}</style> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/3D_design-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/3D_design-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/3D_design-1400.webp"></source> <img src="/assets/img/3D_design.png" class="center-img" width="auto" height="auto" title="3D Design" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>After the successful training of unconstrained gaits, I focused on designing a real-world quadruped based on the specifications derived from the simulation. The details of this physical design process, including hardware considerations, are discussed in the Quadruped Design section.</p> <p>This iterative approach bridged the gap between simulation and real-world application, providing a robust foundation for efficient quadruped locomotion.</p> <hr> <h4 id="reinforcement-learning-for-gaits"><strong>Reinforcement Learning for Gaits</strong></h4> <p>To develop efficient and stable locomotion for the quadruped, a custom MuJoCo environment was designed to integrate the unique features of the robot’s 8-DOF configuration. This environment played a critical role in refining gait patterns through reinforcement learning (RL).</p> <h5 id="custom-environment-features"><strong>Custom Environment Features</strong></h5> <p>The environment was built to closely model the physical quadruped, featuring:</p> <ol> <li> <strong>Action Space</strong>: <ul> <li>Tailored to the 8-DOF quadruped, the action space was designed to ensure precise and efficient motor control.</li> <li>Torque outputs for the motors were restricted to a range of [-20, 20], aligning with the capabilities of the selected motors.</li> <li>This configuration not only facilitated effective simulation but also enabled a seamless transition to real-world torque control.</li> </ul> </li> <li> <strong>Observation Space</strong>: <ul> <li>The observation space was carefully constructed to provide the RL model with a comprehensive understanding of the quadruped’s state. Key components included: <ul> <li> <code class="language-plaintext highlighter-rouge">qpos and qvel</code>: Representing joint positions and velocities relative to their parent bodies, dynamically adapting to changes in the number of links in the model.</li> <li> <code class="language-plaintext highlighter-rouge">IMU Feedback:</code> Positioned at the center of the torso, the IMU provided critical data for maintaining balance and posture.</li> </ul> </li> <li>As new segments were introduced, the expanding observation space was systematically managed to ensure consistent performance during training.</li> </ul> </li> <li> <strong>Energy and Performance Monitoring</strong>: <ul> <li>Metrics such as motor energy consumption, speed, and upright posture were meticulously tracked throughout the training process.</li> <li>These insights were instrumental in optimizing performance, ensuring that the quadruped maintained stability and efficiency during locomotion.</li> </ul> </li> </ol> <div class="row mt-3"> <div class="col-sm mt-2 mt-md-0"> <style>.center-img{display:block;margin-left:auto;margin-right:auto}</style> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/PPO_flowchart-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/PPO_flowchart-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/PPO_flowchart-1400.webp"></source> <img src="/assets/img/PPO_flowchart.png" class="center-img" width="auto" height="auto" title="Flowchart" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>By combining these features, the custom environment offered a realistic simulation platform that effectively bridged the gap between virtual training and real-world implementation. The reinforcement learning process leveraged this robust environment to develop adaptive and reliable gaits for the quadruped.</p> <h5 id="training-process"><strong>Training Process</strong></h5> <p>The quadruped’s locomotion capabilities were developed through a systematic reinforcement learning process using a custom-designed training pipeline. This process included the selection of an appropriate RL algorithm, crafting reward functions tailored to the quadruped’s requirements, and deploying a robust training infrastructure.</p> <ol> <li> <strong>Algorithm Selection and Implementation</strong> <ul> <li>The primary algorithm used was PPO from Stable Baselines3, chosen for its reliability and effectiveness in continuous action spaces. Its ability to balance exploration and exploitation while maintaining training stability made it ideal for the quadruped’s dynamic and complex control requirements.</li> <li>PPO’s hyperparameters were fine-tuned to optimize training outcomes, with the key parameters being: <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> <span class="nv">learning_rate</span><span class="o">=</span>3e-4,
 <span class="nv">n_steps</span><span class="o">=</span>2048,
 <span class="nv">batch_size</span><span class="o">=</span>64,
 <span class="nv">n_epochs</span><span class="o">=</span>10,
 <span class="nv">gamma</span><span class="o">=</span>0.99,
 <span class="nv">gae_lambda</span><span class="o">=</span>0.95,
 <span class="nv">clip_range</span><span class="o">=</span>0.2,
 <span class="nv">clip_range_vf</span><span class="o">=</span>None,
 <span class="nv">ent_coef</span><span class="o">=</span>0.0,
 <span class="nv">vf_coef</span><span class="o">=</span>0.5,
 <span class="nv">max_grad_norm</span><span class="o">=</span>0.5,
 <span class="nv">use_sde</span><span class="o">=</span>False,
 <span class="nv">sde_sample_freq</span><span class="o">=</span><span class="nt">-1</span>,
 <span class="nv">target_kl</span><span class="o">=</span>None,
 <span class="nv">tensorboard_log</span><span class="o">=</span>log_dir,
 <span class="nv">policy_kwargs</span><span class="o">=</span>policy_kwargs,
 <span class="nv">verbose</span><span class="o">=</span>1,
 <span class="nv">normalize_advantage</span><span class="o">=</span>True,
 <span class="nv">device</span><span class="o">=</span><span class="s1">'cpu'</span>
</code></pre></div> </div> </li> </ul> </li> <li> <strong>Exploration of Other Algorithms:</strong> <ul> <li>Alternative algorithms such as Soft Actor Critic (SAC), Advantage Actor Critic (A2C), and Twin Delayed DDPG (TD3) were also tested but did not yield favorable results for this application. These algorithms faced issues in stabilizing the gaits or maintaining efficient learning for the high-dimensional action space of the quadruped.</li> </ul> </li> </ol> <ul> <li> <strong>Reward Functions</strong>: <ul> <li>Custom reward functions were critical in driving the quadruped’s learning process. These functions were designed to encourage desirable behaviors while penalizing inefficient or unstable actions.</li> <li> <strong>Successful Rewards:</strong> <ul> <li> <strong>Speed Reward:</strong><br> A significant reward multiplier (10) was applied to the forward velocity to encourage faster and smoother locomotion.</li> <li> <strong>Upright Posture Reward:</strong><br> To ensure balance, the reward was proportional to the torso’s height relative to the desired upright position, calculated as:<br> <code class="language-plaintext highlighter-rouge">upright_reward = -abs(current_z_position - upright_position)</code> </li> </ul> </li> <li> <strong>Experimental Rewards:</strong> <ul> <li> <strong>Joint Position Reward:</strong><br> Encouraged joint angles to stay within a predefined range, promoting stability. <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> <span class="n">reward</span> <span class="o">=</span> <span class="mi">0</span>
 <span class="k">for</span> <span class="n">joint_name</span><span class="p">,</span> <span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">joint_ranges</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
   <span class="n">joint_angle</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sim</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="nf">get_joint_qpos</span><span class="p">(</span><span class="n">joint_name</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">min_val</span> <span class="o">&lt;=</span> <span class="n">joint_angle</span> <span class="o">&lt;=</span> <span class="n">max_val</span><span class="p">:</span>
       <span class="n">reward</span> <span class="o">+=</span> <span class="mf">1.0</span>
   <span class="k">else</span><span class="p">:</span>
       <span class="n">reward</span> <span class="o">-=</span> <span class="mf">1.0</span>
</code></pre></div> </div> </li> <li> <strong>Joint Effort Penalty:</strong><br> Penalized excessive torque exertion to prevent flailing and promote smooth movement. <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> <span class="n">penalty</span> <span class="o">=</span> <span class="mi">0</span>
 <span class="k">for</span> <span class="n">joint_name</span><span class="p">,</span> <span class="n">max_tor</span> <span class="ow">in</span> <span class="n">max_torque</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
   <span class="n">joint_torque</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sim</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">actuator_force</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">actuator_name2id</span><span class="p">(</span><span class="n">joint_name</span><span class="p">)]</span>
   <span class="k">if</span> <span class="nf">abs</span><span class="p">(</span><span class="n">joint_torque</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_tor</span><span class="p">:</span>
       <span class="n">penalty</span> <span class="o">-=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">joint_torque</span><span class="p">)</span> <span class="o">-</span> <span class="n">max_tor</span><span class="p">)</span>
</code></pre></div> </div> <p>While these experimental rewards provided insights, they proved overly complex or less effective compared to simpler strategies.</p> </li> </ul> </li> </ul> </li> <li> <strong>Training Infrastructure</strong>: <ul> <li>The training was conducted on a headless server to maximize computational efficiency. A virtual environment was created to ensure seamless integration of the training pipeline, which included MuJoCo and Stable Baselines3. All dependencies and configurations are documented in the GitHub repository linked to this project.</li> </ul> </li> </ul> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <div class="embed-container"> <iframe width="640" height="390" src="https://www.youtube.com/embed/LL_hra5FPwY" frameborder="0" allowfullscreen=""></iframe> </div> <style>.embed-container{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;max-height:80%}.embed-container iframe,.embed-container object,.embed-container embed{position:absolute;top:0;left:0;width:100%;height:100%}</style> </div> </div> <hr> <h5 id="evaluation"><strong>Evaluation</strong></h5> <p>Post-training, the model’s performance was rigorously evaluated using logged data and visualized insights.</p> <p>The RL model’s performance was evaluated through metrics like:</p> <ol> <li> <strong>Performance Metrics:</strong> <ul> <li> <strong>Energy Expenditure:</strong> Assessed the total energy consumed by the quadruped during locomotion to identify efficient gait patterns.</li> <li> <strong>Motor Efficiency:</strong> Evaluated the torque-to-energy ratio to ensure optimal motor utilization and reduced power wastage.</li> <li> <strong>Maximum Velocity:</strong> Measured the peak velocity achieved during simulation without compromising stability or balance.</li> </ul> </li> <li> <strong>Training Metrics and Model Selection:</strong> <ul> <li>Training progress was monitored using TensorBoard, particularly focusing on value loss, which served as a key indicator of model stability and convergence.</li> <li>Comparative analysis of value loss across different timesteps helped identify the best-trained models. Timesteps with consistently lower value loss, indicative of reduced variance and improved learning, were selected for deployment.</li> <li>Key checkpoints were analyzed to balance performance and efficiency, ensuring the selected models excelled in metrics like reward accumulation and energy optimization.</li> </ul> </li> </ol> <div class="row"> <div class="col"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/val_loss_1-480.webp 480w,/assets/img/val_loss_1-800.webp 800w,/assets/img/val_loss_1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/val_loss_1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Value Loss 1" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/val_loss_2-480.webp 480w,/assets/img/val_loss_2-800.webp 800w,/assets/img/val_loss_2-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/val_loss_2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Value Loss 2" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="col"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/val_loss_3-480.webp 480w,/assets/img/val_loss_3-800.webp 800w,/assets/img/val_loss_3-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/val_loss_3.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Value Loss 3" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/val_loss_4-480.webp 480w,/assets/img/val_loss_4-800.webp 800w,/assets/img/val_loss_4-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/val_loss_4.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Value Loss 4" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> </div> <p>The best-performing models were identified by analyzing the value loss curve during training. Models where the value loss steadily decreased and reached near-zero values at specific timesteps produced the most stable and efficient walking gaits. These curves reflected well-converged policies with minimal variance between predicted and actual rewards.</p> <p>In contrast, models with value loss curves that plateaued early or fluctuated excessively resulted in suboptimal gaits, marked by instability or inefficient motor control. Successful models displayed a clear downward trend in value loss, aligning with balanced, energy-efficient locomotion. Focusing on these timesteps ensured the selection of optimal gaits and refined overall performance.</p> <ul> <li> <strong>Visualization Tools:</strong> <ul> <li>TensorBoard provided real-time insights into reward trends, policy gradients, and loss metrics during training.</li> <li>Custom plots for energy consumption, motor power, and velocity trends offered a comprehensive view of the quadruped’s capabilities, aiding in further refinement.</li> <li>Trends in the value loss curve were used to validate the effectiveness of training strategies and ensure alignment with performance goals.</li> </ul> </li> </ul> <p>This structured evaluation approach facilitated the selection of optimal models while providing actionable insights to guide future iterations and enhance the quadruped’s real-world performance.</p> <div class="row"> <div class="col"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/3D-metrics-480.webp 480w,/assets/img/3D-metrics-800.webp 800w,/assets/img/3D-metrics-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/3D-metrics.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="3D metrics" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Single link metrics </div> </div> <div class="col"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/seg_back-480.webp 480w,/assets/img/seg_back-800.webp 800w,/assets/img/seg_back-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/seg_back.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="seg back metrics" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Segmented back metrics </div> </div> </div> <p>The left cluster of graphs is for a single link torso and the right is for a multi link torso. We can easily compare that the max speed achieved by a segmented back is 1.47 while the single link is about 0.8. This was indicative of the design changes were in the right direction.</p> <hr> <h4 id="designing-and-building-the-quadruped"><strong>Designing and Building the Quadruped</strong></h4> <p>The quadruped design bridged simulation and hardware, featuring modularity, precision actuation, robust electronics, and real-time sensing.</p> <ul> <li> <strong>Mechanical Structure</strong>: <ul> <li> <strong>Frame Design:</strong> <ul> <li>Built using 20-20 aluminum extrusions for a lightweight yet durable frame. The modular design allows for easy adjustments and upgrades to suit user needs.</li> <li>Integrated belt-pulley systems inspired by earlier MIT Cheetah versions provided smooth, efficient leg motion. The 20-20 extrusions facilitated easy belt tensioning.</li> </ul> </li> <li> <strong>Custom Parts:</strong> <ul> <li>Custom aluminum components were designed and manufactured to accommodate high-torque motor assemblies, ensuring durability under load and preventing structural failures.</li> </ul> </li> <li> <strong>Iterative Prototyping</strong> <ul> <li>Continuous design iterations refined the mechanical structure, as illustrated below:</li> </ul> </li> </ul> </li> </ul> <div class="row mt-3"> <div class="col-sm mt-2 mt-md-0"> <style>.center-img{display:block;margin-left:auto;margin-right:auto}</style> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/mech_iterations.drawio-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/mech_iterations.drawio-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/mech_iterations.drawio-1400.webp"></source> <img src="/assets/img/mech_iterations.drawio.png" class="center-img" width="auto" height="auto" title="Flowchart" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <ul> <li> <strong>Actuation and Control</strong>: <ul> <li> <strong>Motor Selection</strong> <ul> <li>Torque demands from MuJoCo simulations identified a peak of 21Nm for the larger quadruped.</li> <li>High-speed brushless DC motors <a href="https://www.steadywin.cn/pd.jsp?id=134#_jcp=3_3" rel="external nofollow noopener" target="_blank">Steadywin GIM8108-8</a> with a peak torque output of 22Nm were selected to meet these requirements, balancing high rotational speed with lightweight construction.</li> <li>The motors come with integrated ODrive controllers for precise control and seamless hardware interfacing, enabling rapid prototyping and tuning.</li> </ul> </li> <li> <p><strong>Motor Specifications</strong></p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>    - Gear Ratio - 8:1
    - Diameter - 97mm
    - Stall Torque - 22Nm
    - Nominal Torque - 7.5Nm
    - No Load Speed - 320rpm
    - Nominal Current Rating - 7A
    - Peak Current Rating - 25A
    - Voltage Rating - 48V
    - Mass - 375g
</code></pre></div> </div> </li> <li>The motor information is attached here. <ul> <li><a href="/assets/img/33.jpg">Motor information</a></li> <li><a href="/assets/pdf/SteadyWin_GIM6010-8_Manual_rev1.pdf">Motor Datasheet</a></li> </ul> </li> </ul> </li> </ul> <div class="row"> <div class="col"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/motor-480.webp 480w,/assets/img/motor-800.webp 800w,/assets/img/motor-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/motor.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Motor" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Steadywin GIM 8108-8 Motors </div> </div> <div class="col"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dog_leg_design-480.webp 480w,/assets/img/dog_leg_design-800.webp 800w,/assets/img/dog_leg_design-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/dog_leg_design.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="leg Design" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> Complete Leg Design </div> </div> </div> <ul> <li> <strong>Feet Design</strong> <ul> <li> <strong>3D-Printed Feet:</strong> <ul> <li>The feet were based on a design from <a href="https://www.thingiverse.com/thing:5404058" rel="external nofollow noopener" target="_blank">Thingiverse</a>, originally used for 3D printers.</li> <li>Inspired by the MIT Cheetah, squash balls were utilized for cushioning and durability.</li> </ul> </li> </ul> </li> <li> <strong>Electronics</strong> <ul> <li> <strong>Power Supply</strong> <ul> <li>Each motor was powered by a 48V-25A power supply, with one supply handling four motors simultaneously.</li> <li>This power supply was selected for its ability to deliver a peak current of 25A, which comfortably exceeds the combined current required by 4 motors for position control.</li> <li> <a href="https://www.amazon.com/BOSYTRO-Switching-Transformer-Security-Industrial/dp/B0CWTY3G1C?crid=3N6PAJJWM48IX&amp;dib=eyJ2IjoiMSJ9.JwQ5wUAfersA751DQzAN8UCs2y9rV1ASN-KIYq6DzLH-4czIkQQKia4z7YiqPql-94A3OA2g8fjTq4gG3p0A7OuF49hgJqFwrE7v9orUOxMg-4u1sumUQ4fvg4MlbVBJhRwCyIi-bVl3Mfxz9fpqdSuNcBJf3jOWsmpTKtZ-TFtr7JmfrPEbBKZQl1wDG3hB1omnKIK1c5TcahXdz4IRqFskz31rKPqtQOFtr0UmZR0oJOXRSaWr2n2KoHiJj8HLt2ohO3KcfxHkPrpuQMrH65hnHUMLBx8KiuuaABQzB6o.hTOJSAWli0_erfQR_bbYcKEogYxvRgp6WB60dcbRChw&amp;dib_tag=se&amp;keywords=48v%2Bpower%2Bsupply%2B30a&amp;qid=1731359779&amp;s=electronics&amp;sprefix=48v%2Bpower%2Bsupply%2B30a%2Celectronics%2C114&amp;sr=1-1&amp;th=1" rel="external nofollow noopener" target="_blank">Link</a> to the power supply.</li> </ul> </li> <li> <strong>Communication</strong> <ul> <li>A Raspberry Pi 4B, equipped with an RS485 CAN-HAT, facilitated CAN-bus communication with the ODrive controllers for efficient motor control.</li> </ul> </li> </ul> </li> <li> <strong>Sensors</strong>: <ul> <li> <strong>IMUs and Encoders:</strong> <ul> <li>Integrated sensors provided real-time feedback for accurate motion tracking.</li> <li>These sensors ensured stability and precise replication of the trained RL model’s behavior in physical tests.</li> </ul> </li> </ul> </li> </ul> <h5 id="full-quadruped-pictures"><ins><strong>Full Quadruped Pictures</strong></ins></h5> <p>Here are some pictures of the fully built quadruped</p> <div class="row"> <div class="col"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/full_dog_1-480.webp 480w,/assets/img/full_dog_1-800.webp 800w,/assets/img/full_dog_1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/full_dog_1.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Dog Setup" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="col"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/full_dog_2-480.webp 480w,/assets/img/full_dog_2-800.webp 800w,/assets/img/full_dog_2-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/full_dog_2.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Dog Setup 2" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> </div> <p>The video on the right shows position control test for motors in home position. The video on the left is a small snipped on the quadruped standing under its own weight.</p> <div class="row"> <div class="col"> <div class="col-sm mt-3 mt-md-0"> <div class="embed-container"> <iframe width="640" height="390" src="https://www.youtube.com/embed/MRok_12rD68" frameborder="0" allowfullscreen=""></iframe> </div> <style>.embed-container{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;max-height:80%}.embed-container iframe,.embed-container object,.embed-container embed{position:absolute;top:0;left:0;width:100%;height:100%}</style> </div> <div class="caption"> Dog Standing under its own weight </div> </div> <div class="col"> <div class="col-sm mt-3 mt-md-0"> <div class="embed-container"> <iframe width="640" height="390" src="https://www.youtube.com/embed/BXxDHsZlvpk" frameborder="0" allowfullscreen=""></iframe> </div> <style>.embed-container{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;max-height:80%}.embed-container iframe,.embed-container object,.embed-container embed{position:absolute;top:0;left:0;width:100%;height:100%}</style> </div> <div class="caption"> Position Control of the Dog </div> </div> </div> <hr> <h4 id="sim-to-real-pipeline"><strong>Sim-to-Real Pipeline</strong></h4> <p>The transition from simulation to reality was facilitated through a well-defined sim-to-real pipeline:</p> <ul> <li> <strong>Direct Deployment</strong>: <ul> <li>The RL trained model can be deployed on the real robot directly as the mujoco model is modelled directly around the real quadruped.</li> <li>The action space of the model is torques, so the RL model can be deployed using torque control.</li> <li>Another way it can be deployed is using position control and deploying positions for motors which can be extracted directly from mujoco’s physics simulations.</li> <li>Here is a layout of how this deployment would work:</li> </ul> </li> </ul> <div class="row mt-3"> <div class="col-sm mt-2 mt-md-0"> <style>.center-img{display:block;margin-left:auto;margin-right:auto}</style> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/sim_real.drawio-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/sim_real.drawio-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/sim_real.drawio-1400.webp"></source> <img src="/assets/img/sim_real.drawio.png" class="center-img" width="auto" height="auto" title="Flowchart" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <ul> <li> <strong>Future Works</strong>: <ul> <li>Plans include integrating OptiTrack or camera-based systems to improve positional accuracy during real-world tests.</li> <li>Implementing the segmented back setup on a real quadruped.</li> <li>Completing the sim to real pipeline for the built quadruped.</li> </ul> </li> </ul> <hr> <h4 id="innovations-and-learnings"><strong>Innovations and Learnings</strong></h4> <p>The project introduced several unique features that improved speed and efficiency:</p> <ol> <li> <strong>Reduced Motors</strong>: Achieving high speeds with an 8-DoF configuration reduced cost and complexity while maintaining effective locomotion.</li> <li> <strong>Segmented Back</strong>: Inspired by animal anatomy, this feature significantly enhanced the quadruped’s agility and speed in both simulation and physical tests.</li> <li> <strong>Custom RL Environment</strong>: Developing a tailored environment allowed efficient training and evaluation of locomotion strategies, with detailed metrics for energy optimization.</li> </ol> <hr> <details> <summary><b>Working with Stanford Pupper V1</b></summary> <p> I also worked with a Stanford Pupper before designing my own quadruped. I built and assembled the Pupper V1 kit available on MangDang.com. This particular open-source quadruped was selected for two main reasons: it is completely open-source and easy to fix, and its single-segment back allowed for quick iterations if needed. </p> <ul> <li> <b>Reinforcement Learning with the Pupper:</b> <ul> <li> Similar iterations were performed on the Pupper and trained in simulation using MuJoCo. The walking gaits were also converted and implemented on the real robot using an open-loop position control method. </li> </ul> </li> <li> <b>MuJoCo Models:</b> <ul> <li> Here are the MuJoCo models of the Pupper used for simulation. </li> </ul> </li> <li> <b>Issues with the Pupper:</b> <ul> <li> After completing the open-loop pipeline, I identified several issues with the Pupper that led to designing my own quadruped. These include: <ul> <li> The goal was to create a very fast quadruped, but this was challenging using hobby servos on the Pupper. </li> <li> The Pupper exhibited poor stability and had difficulty walking on tile floors due to its very thin carbon fiber leg design, which caused it to slip. Adding rubber washers to the feet did not significantly improve stability. </li> <li> Open-loop control proved insufficient for maintaining stability. These limitations suggested that the Pupper V1 hardware was not suitable for the intended tasks. </li> </ul> </li> </ul> </li> <li> <b>Video of the Open-Loop Control on the Pupper:</b> <div class="embed-container"> <iframe width="640" height="390" src="https://www.youtube.com/embed/fUjVGjAbxI8" frameborder="0" allowfullscreen=""></iframe> </div> <style>.embed-container{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;max-height:80%}.embed-container iframe,.embed-container object,.embed-container embed{position:absolute;top:0;left:0;width:100%;height:100%}</style> </li> </ul> </details> <hr> <h4 id="aknowledgements"><strong>Aknowledgements</strong></h4> <ul> <li> <a href="https://robotics.northwestern.edu/people/profiles/faculty/elwin-matt.html" rel="external nofollow noopener" target="_blank">Matthew Elwin</a> - For constant support and guidance throughout this project.</li> <li> <a href="https://dlandry97.github.io/Davin_Landry/" rel="external nofollow noopener" target="_blank">Davin Landry</a> - Helping me with mechanical Design iterations.</li> </ul> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Shail Dalal. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?07b8786bab9b4abe90d10e61f7d12ff7" type="text/javascript"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>